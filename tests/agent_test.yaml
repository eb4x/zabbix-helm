suite: test zabbix-agent
templates:
  - zabbix-agent.yaml
tests:
  - it: defaults to
    asserts:
      - isKind:
          of: DaemonSet
      - isNotEmpty:
          path: spec.template.spec.containers[0].livenessProbe
      - isNotEmpty:
          path: spec.template.spec.containers[0].startupProbe
      - contains:
          path: spec.template.spec.containers[0].ports
          content:
            name: zabbix-agent
            containerPort: 10050
            protocol: TCP

  - it: shouldn't have startup/liveness probe or ports
    set:
      zabbixAgent.env:
        - name: ZBX_PASSIVE_ALLOW
          value: false
    asserts:
      - isNull:
          path: spec.template.spec.containers[0].livenessProbe
      - isNull:
          path: spec.template.spec.containers[0].startupProbe
      - isNull:
          path: spec.template.spec.containers[0].ports
